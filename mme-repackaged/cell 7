from sagemaker.multidatamodel import MultiDataModel

mme_prefix = f"{MODEL_PREFIX}"

container_image = sagemaker.image_uris.retrieve("xgboost", region, version="1.3-1")

mme = MultiDataModel(
    name=f"{PROJECT_NAME}-mme",
    model_data_prefix=mme_prefix,
    image_uri=container_image,
    role=role,
    sagemaker_session=sm_sess
)

# Register each target model tarball
for tgt in TARGET_COLS:
    model_key = f"{tgt}/model_mme.tar.gz"
    mme.add_model(
        model_data=f"{MODEL_PREFIX}/{model_key}",
        name=model_key
    )

endpoint_name = f"{PROJECT_NAME}-endpoint"

mme.deploy(
    initial_instance_count=1,
    instance_type="ml.m5.xlarge",
    endpoint_name=endpoint_name
)

print("Deployed:", endpoint_name)
