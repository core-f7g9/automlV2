# 1. Get the SKLearn container image URI
image_uri = sagemaker.image_uris.retrieve(
    framework="sklearn",
    region=region,
    version="1.2-1", # Must match the version used in training
    py_version="py310",
    instance_type=INSTANCE_TYPE
)

# 2. Define the SKLearnModel (points to inference code, not a specific model file)
sklearn_model = SKLearnModel(
    model_data=None, # MME requires this to be None
    role=role,
    image_uri=image_uri,
    entry_point="inference.py",
    source_dir="./source_code/code", # Points only to the directory containing inference.py
    dependencies=[os.path.join(source_dir, "requirements.txt")], # Specify the requirements
    sagemaker_session=sm_sess,
)

# 3. Define the MultiDataModel (points to the S3 prefix)
mme = MultiDataModel(
    name=ENDPOINT_NAME,
    model_data_prefix=MME_S3_PREFIX, # CRITICAL: This points to the folder containing ALL models
    model=sklearn_model,
    sagemaker_session=sm_sess,
)

# 4. Deploy the MME
print(f"Deploying Multi-Model Endpoint: {ENDPOINT_NAME} on {INSTANCE_TYPE}...")
mme.deploy(
    initial_instance_count=1,
    instance_type=INSTANCE_TYPE,
    endpoint_name=ENDPOINT_NAME,
    wait=False, # Set to True to block until deployment is finished
)

print(f"Endpoint deployment started for: {ENDPOINT_NAME}")