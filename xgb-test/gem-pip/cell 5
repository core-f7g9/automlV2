import boto3
import json
import numpy as np

# Wait for the endpoint to be in service if you set wait=False in Cell 4
print(f"Waiting for endpoint {ENDPOINT_NAME} to be InService...")
sm_client = boto3.client("sagemaker")
waiter = sm_client.get_waiter('endpoint_in_service')
waiter.wait(EndpointName=ENDPOINT_NAME)
print("Endpoint is ready.")

# --- Example Payload (Mock data with your INPUT_FEATURES) ---
# NOTE: The data must be an array of features, matching the order used in training
example_features = ["Vendor A", "Server Maintenance Fee", "101"] 
payload_csv = ",".join(example_features) # Payload as CSV string
print(f"\nPayload: {payload_csv}")

# --- Invoke for one specific target model ---
target_model_name = "model-AccountCode.tar.gz" # Target one of your trained models
print(f"Invoking MME for TargetModel: {target_model_name}")

sagemaker_runtime = boto3.client("sagemaker-runtime")

response = sagemaker_runtime.invoke_endpoint(
    EndpointName=ENDPOINT_NAME,
    ContentType="text/csv",
    Accept="application/json",
    Body=payload_csv,
    TargetModel=target_model_name # CRITICAL: Tells MME which model to load
)

prediction_json = response["Body"].read().decode()
prediction = json.loads(prediction_json)

print(f"\nPrediction for {target_model_name}: {prediction}")