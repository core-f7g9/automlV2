# ============================
# CELL A5 — Test Invocation
# ============================
from sagemaker.predictor import Predictor
from sagemaker.serializers import JSONSerializer
from sagemaker.deserializers import JSONDeserializer

predictor = Predictor(
    endpoint_name=ENDPOINT_NAME,
    sagemaker_session=sm_sess,
    serializer=JSONSerializer(),
    deserializer=JSONDeserializer()
)

sample_payload = {
    "VendorName": "Acme Corp",
    "LineDescription": "Office supplies monthly invoice",
    "ClubNumber": 123
}

target_model = "DepartmentCode.tar.gz"

response = predictor.predict(
    sample_payload,  # Just pass the dict, serializer handles JSON
    target_model=target_model
)

print("\n✅ Response:", response)

# ============================
# CELL A6 — Test All Models
# ============================
targets = [
    "DepartmentCode.tar.gz",
    "AccountCode.tar.gz",
    "SubAccountCode.tar.gz",
    "LocationCode.tar.gz"
]

for m in targets:
    print(f"\n{'='*50}")
    print(f"Testing: {m}")
    print('='*50)
    try:
        resp = predictor.predict(sample_payload, target_model=m)
        print("Prediction:", resp.get("prediction"))
        print("Top 3 probabilities:", resp.get("probabilities", [])[:3])
    except Exception as e:
        print(f"❌ Error: {e}")